<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Li√™n h·ªá ‚Äî MGX Demo</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./contact.css" />
  </head>
  <body>
    <header class="nav" role="banner">
      <a class="brand" href="index.html">
        <div class="logo">MG</div>
        <div>
          <div style="font-weight: 700">MGX ‚Äî Demo</div>
          <div style="font-size: 12px; color: var(--muted)">
            M√¥ ph·ªèng giao di·ªán
          </div>
        </div>
      </a>
      <nav class="menu" id="main-menu" role="navigation" aria-label="Ch√≠nh">
        <a href="index.html">Trang ch·ªß</a>
        <a href="features.html">T√≠nh nƒÉng</a>
        <a href="gallery.html">Giao di·ªán</a>
        <a href="contact.html" class="active">Li√™n h·ªá</a>
        <a href="blog.html">Blog</a>
        <a class="cta" href="#">T·∫£i v·ªÅ</a>
        <button
          id="theme-toggle"
          title="Chuy·ªÉn ƒë·ªïi Dark/Light Mode"
          style="margin-left: 10px"
        >
          üåô
        </button>
      </nav>
      <button
        class="menu-toggle"
        id="menu-toggle"
        aria-controls="main-menu"
        aria-expanded="false"
        aria-label="Toggle Menu"
      >
        &#9776;
      </button>
    </header>

    <div class="wrap">
      <main>
        <div class="page-header">
          <h1>Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h1>
          <p class="subhead">
            G·ª≠i th·∫Øc m·∫Øc, y√™u c·∫ßu h·ªó tr·ª£ ho·∫∑c ph·∫£n h·ªìi c·ªßa b·∫°n.
          </p>
        </div>

        <section id="contact-form-section" class="contact-section">
          <form class="contact-form" id="contact-form">
            <div class="form-group">
              <label for="name">T√™n c·ªßa b·∫°n</label>
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"
              />
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="v√≠ d·ª•@congty.com"
              />
            </div>
            <div class="form-group">
              <label for="message">N·ªôi dung tin nh·∫Øn</label>
              <textarea
                id="message"
                name="message"
                required
                placeholder="Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n ·ªü ƒë√¢y..."
              ></textarea>
            </div>

            <button
              type="submit"
              class="btn primary"
              id="submit-btn"
              style="margin-top: 10px"
            >
              G·ª≠i Tin Nh·∫Øn
            </button>
          </form>
        </section>
      </main>
    </div>

    <footer>
      <p>&copy; 2025 MGX. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </footer>

    <button id="back-to-top" title="Quay l·∫°i ƒë·∫ßu trang">‚Üë</button>

    <div id="welcome-modal" class="modal-overlay">
      <div class="modal-content">
        <h2>üéâ Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi MGX Demo</h2>
        <p>
          Ch√∫ng t√¥i hy v·ªçng b·∫°n s·∫Ω th√≠ch th√∫ v·ªõi giao di·ªán hi·ªán ƒë·∫°i n√†y. ƒê·ª´ng
          ng·∫ßn ng·∫°i kh√°m ph√° c√°c t√≠nh nƒÉng m·ªõi nh∆∞ Dark/Light Mode!
        </p>
        <button class="modal-close-btn" aria-label="ƒê√≥ng Pop-up">
          B·∫Øt ƒë·∫ßu
        </button>
      </div>
    </div>

    <script>
      const App = {
        init: function () {
          this.initTheme();
          this.pageFadeIn();
          this.toggleMenu();
          this.initBackToTop();
          this.showWelcomeModal();
          this.initContactForm(); // <-- H√ÄM X·ª¨ L√ù G·ª¨I EMAIL TH·∫¨T
        },

        pageFadeIn: function () {
          document.body.classList.add("page-loaded");
        },

        /* DARK/LIGHT MODE LOGIC */
        initTheme: function () {
          const themeToggle = document.getElementById("theme-toggle");
          const savedTheme = localStorage.getItem("theme");
          const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches;

          if (savedTheme === "light") {
            document.body.classList.add("light-mode");
          } else if (savedTheme === "dark") {
            document.body.classList.remove("light-mode");
          } else if (!prefersDark) {
            document.body.classList.add("light-mode");
          }

          if (themeToggle) {
            themeToggle.addEventListener("click", () => this.toggleTheme());
            this.updateThemeButtonText();
          }
        },

        toggleTheme: function () {
          const isLight = document.body.classList.toggle("light-mode");
          localStorage.setItem("theme", isLight ? "light" : "dark");
          this.updateThemeButtonText();
        },

        updateThemeButtonText: function () {
          const themeToggle = document.getElementById("theme-toggle");
          if (themeToggle) {
            const isLight = document.body.classList.contains("light-mode");
            themeToggle.textContent = isLight ? "üåû" : "üåô";
          }
        },

        /* X·ª¨ L√ù MOBILE MENU */
        toggleMenu: function () {
          const menuToggle = document.getElementById("menu-toggle");
          const mainMenu = document.getElementById("main-menu");

          if (menuToggle && mainMenu) {
            menuToggle.addEventListener("click", () => {
              const isExpanded =
                menuToggle.getAttribute("aria-expanded") === "true" || false;
              mainMenu.classList.toggle("is-open");
              menuToggle.setAttribute("aria-expanded", !isExpanded);
            });
          }
        },

        /* H√ÄM G·ª¨I EMAIL TH·∫¨T (D√πng Fetch API g·ªçi server.js) */
        initContactForm: function () {
          const contactForm = document.getElementById("contact-form");
          const submitBtn = document.getElementById("submit-btn");

          if (contactForm && submitBtn) {
            contactForm.addEventListener("submit", async (e) => {
              e.preventDefault();

              submitBtn.disabled = true;
              submitBtn.textContent = "ƒêang g·ª≠i...";

              const formData = {
                name: document.getElementById("name").value,
                email: document.getElementById("email").value,
                message: document.getElementById("message").value,
              };

              try {
                const response = await fetch("/send-mail", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                  },
                  body: JSON.stringify(formData),
                });

                const result = await response.json();

                if (response.ok) {
                  alert(`‚úÖ G·ª≠i th√†nh c√¥ng! C·∫£m ∆°n b·∫°n, ${formData.name}.`);
                  contactForm.reset();
                } else {
                  alert(
                    `‚ùå L·ªói g·ª≠i tin nh·∫Øn: ${
                      result.message ||
                      "Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß g·ª≠i mail."
                    }`
                  );
                }
              } catch (error) {
                console.error("L·ªói Fetch/Network:", error);
                alert(
                  "‚ùå ƒê√£ x·∫£y ra l·ªói m·∫°ng. Vui l√≤ng ƒë·∫£m b·∫£o server ƒëang ch·∫°y."
                );
              } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = "G·ª≠i Tin Nh·∫Øn";
              }
            });
          }
        },

        /* H√ÄM H·ªñ TR·ª¢ CU·ªòN TRANG */
        initBackToTop: function () {
          const backToTopButton = document.getElementById("back-to-top");
          if (!backToTopButton) return;

          const scrollFunction = () => {
            if (
              document.body.scrollTop > 300 ||
              document.documentElement.scrollTop > 300
            ) {
              backToTopButton.style.display = "block";
            } else {
              backToTopButton.style.display = "none";
            }
          };

          window.addEventListener("scroll", scrollFunction);
          backToTopButton.addEventListener("click", () => {
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
          });
        },

        /* POP-UP CH√ÄO M·ª™NG */
        showWelcomeModal: function () {
          const modal = document.getElementById("welcome-modal");
          const closeBtn = document.querySelector(".modal-close-btn");
          // Ch·ªâ hi·ªán pop-up l·∫ßn ƒë·∫ßu ti√™n
          const isFirstVisit = localStorage.getItem("isFirstVisit") === null;

          if (modal && closeBtn && isFirstVisit) {
            setTimeout(() => {
              modal.classList.add("is-open");
            }, 1000);

            const closeModal = () => {
              modal.classList.remove("is-open");
              localStorage.setItem("isFirstVisit", "false");
            };

            closeBtn.addEventListener("click", closeModal);
            modal.addEventListener("click", (e) => {
              if (e.target === modal) {
                closeModal();
              }
            });
            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape" && modal.classList.contains("is-open")) {
                closeModal();
              }
            });
          }
        },
      };

      // Ch·∫°y App khi DOM ƒë√£ t·∫£i xong
      document.addEventListener("DOMContentLoaded", () => App.init());
    </script>
  </body>
</html>
